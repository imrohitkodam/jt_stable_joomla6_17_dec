/*
 * @package    JTicketing
 * @author     Techjoomla <extensions@techjoomla.com>
 *
 * @copyright  Copyright (c) 2009-2020 TechJoomla. All rights reserved.
 * @license    GNU General Public License version 2 or later.
 */
var jtSite={events:{init:function(){jQuery(document).ready((function(){1!=localStorage.getItem("flag")&&0==localStorage.getItem("flag")||jQuery(".events__filter").toggleClass("hide active")}))},toggleDiv:function(e){jQuery(window).width()<767&&jQuery("#"+e).toggle(),1==localStorage.getItem("flag")?localStorage.setItem("flag",0):localStorage.setItem("flag",1),jQuery(".events__filter").toggleClass("hide active"),jQuery(".events__filter").is(":visible")?jQuery("#mobiledisplayFilter").html("<i class='fa mr-5 fa-minus' aria-hidden='true'></i>"+Joomla.JText._("COM_JTICKETING_FILTERS_MORE_LBL")):jQuery("#mobiledisplayFilter").html("<i class='fa mr-5 fa-plus' aria-hidden='true'></i>"+Joomla.JText._("COM_JTICKETING_FILTERS_MORE_LBL")),"searchFilterInputBox"==e&&(jQuery(".events__search").toggleClass("active hide"),jQuery(".sort-result").hasClass("show")&&jQuery(".sort-result").removeClass("show").addClass("hide")),jQuery(".venueSearchli").toggleClass("active")},displayMobileFilter:function(){jQuery("#mobileFilter").toggleClass("hidden-xs")},calendarSubmit:function(e,t){if(jQuery("#jtwrap.tjBs5").length)var o="#filter_day_chosen";else o="#filter_day_chzn";jQuery(window).width()<767&&(o="#filter_day");""!=e&&-1==jQuery.inArray(e,["today","tomorrow","weekend","thisweek","nextweek","thismonth","nextmonth"])?(jQuery(o).daterangepicker({autoUpdateInput:!1,locale:{cancelLabel:"Clear"}}),jQuery(o).on("apply.daterangepicker",(function(r,a){jQuery(o).val(a.startDate.format("YYYY-MM-DD")+" - "+a.endDate.format("YYYY-MM-DD")),jQuery(o).css("display","block");var n=jQuery(".drp-selected").text();jQuery("#filter_day option[value="+e+"]").val(n),jQuery("#filter_day").trigger("liszt:updated"),jQuery("#filter_day").trigger("chosen:updated"),t.form.submit()})),jQuery(o).on("cancel.daterangepicker",(function(){jQuery(this).val("")}))):t.form.submit()},resetCalendar:function(e){jQuery("#filter_day").val(""),e.form.submit()},localTimeEvents:function(e,t,o){e=new Date(e.replace(/-/g,"/"));e=jtSite.event.formatDate(e);t=new Date(t.replace(/-/g,"/"));t=jtSite.event.formatDate(t),1==guest&&(e+=" UTC",t+=" UTC"),e=new Date(e.replace(/-/g,"/")),e=jtSite.event.formatTime(e),t=new Date(t.replace(/-/g,"/")),t=jtSite.event.formatTime(t);var r=(new Date).toString().match(/\(([A-Za-z\s].*)\)/)[1];jQuery(".time"+o).html("("+Joomla.JText._("COM_JTICKETING_YOUR_TIME")+e+" - "+t+" "+r+")")}},venue:{initVenueJs:function(){jQuery(document).ready((function(){jtSite.venue.showHideVenueSeat()}))},onChangefun:function(){jQuery("#venue_gallary_filter").change((function(){var e=document.getElementById("venue_gallary_filter").value;if("1"==e){jQuery("#venue_videos").show(),jQuery("#venue_images").hide();const e=document.createElement("h5"),t=document.createTextNode(Joomla.JText._("COM_JTICKETING_GALLERY_VIDEO_TEXT"));e.appendChild(t),jQuery(".videosText").html(e),jQuery(".imagesText").hide()}else if("2"==e){jQuery("#venue_videos").hide(),jQuery("#venue_images").show();const e=document.createElement("h5"),t=document.createTextNode(Joomla.JText._("COM_JTICKETING_GALLERY_IMAGE_TEXT"));e.appendChild(t),jQuery(".videosText").html(e),jQuery(".imagesText").hide()}else if("0"==e){jQuery("#venue_videos").show(),jQuery("#venue_images").show();const e=document.createElement("h5"),t=document.createTextNode(Joomla.JText._("COM_JTICKETING_VENUE_VIDEOS"));e.appendChild(t),jQuery(".videosText").html(e),jQuery(".imagesText").show()}})).change()},showHideVenueSeat:function(){"0"==techjoomla.jQuery("#jform_seats_capacity").val()?techjoomla.jQuery(".capacityCountRow").removeClass("af-d-none"):techjoomla.jQuery(".capacityCountRow").addClass("af-d-none")}},venueForm:{initializeGMapSuggest:function(){input=document.getElementById("jform_address");new google.maps.places.Autocomplete(input)},initVenueFormJs:function(){googleMapApiKey&&google.maps.event.addDomListener(window,"load",jtSite.venueForm.initializeGMapSuggest),jQuery(document).ready((function(){jQuery('input[name="jform[online]').click((function(){jtSite.venueForm.showOnlineOffline(jQuery('input[name="jform[online]"]:checked').val())})),jtSite.venueForm.showOnlineOffline(jQuery('input[name="jform[online]"]:checked').val()),jQuery("#jform_online_provider").change((function(){jtSite.venueForm.getPluginParams()})),(editId&&1==jQuery('input[name="jform[online]"]:checked').val()||1==jQuery('input[name="jform[online]"]:checked').val())&&jtSite.venueForm.getPluginParams();try{jQuery.each(mediaGallery,(function(e,t){tjMediaFile.previewFile(t,1)}))}catch(e){console.log(e)}getValue&&jQuery("#jform_online_provider").trigger("change"),jtSite.venueForm.venueCapacityCheck(),jQuery("#jform_seats_capacity").change((function(){jtSite.venueForm.venueCapacityCheck()}))}))},venueCapacityCheck:function(){0==jQuery("#jform_seats_capacity").val()?jQuery("#jform_capacity_count").addClass("required"):jQuery("#jform_capacity_count").removeClass("required")},showOnlineOffline:function(e){1==e?(jQuery("#jform_online_provider").closest(".online_provider_wrap").show(),jQuery("#provider_html").show(),jQuery("#jform_offline_provider").hide()):(jQuery("#jform_online_provider").closest(".online_provider_wrap").hide(),jQuery("#provider_html").hide(),jQuery("#jform_offline_provider").show())},venueFormSubmitButton:function(e){if("venueform.save"==e){jQuery('input[name="jform[jform_name]"]:checked').val(),jQuery('input[name="jform[api_username]"]:checked').val(),jQuery('input[name="jform[api_password]"]:checked').val(),jQuery('input[name="jform[host_url]"]:checked').val(),jQuery('input[name="jform[source_sco_id]"]:checked').val();var t=jQuery('input[name="jform[online]"]:checked').val(),o=jQuery("#jform_online_provider").val();if(editId&&"0"==t&&(jQuery("#api_username").val(""),jQuery("#api_password").val(""),jQuery("#host_url").val(""),jQuery("#source_sco_id").val("")),!document.formvalidator.isValid(document.getElementById("form-venue")))return!1;if(1==jQuery('input[name="jform[online]"]:checked').val()){if(!o||"0"==o)return alert(Joomla.JText._("COM_JTICKETING_VENUE_FORM_ONLINE_PROVIDER")),jQuery("#jform_online_provider").focus(),!1;let e=document.createElement("form");for(fields=jQuery("#provider_html").find("input, textarea, select, fieldset"),i=0,l=fields.length;i<l;i++){let t=fields[i].cloneNode(!0);e.appendChild(t)}if(!document.formvalidator.isValid(e))return!1;jsonObj=[],jQuery("#provider_html input").each((function(){var e=jQuery(this).attr("id"),t=jQuery(this).val();item={},item.id=e,item.output=t;jsonObj.push(item);jsonString=JSON.stringify(item),jQuery("#venue_params").val(jsonString)}))}else if(!jQuery("#jform_address").val()){var r="";return r+="<br />"+Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_FORM_LBL_VENUE_ADDRESS"),Joomla.renderMessages({warning:[r]}),jQuery("#jform_address").focus(),!1}if(!jQuery("#form-venue #jform_name").val()){r="";return r+="<br />"+Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_FORM_LBL_VENUE_TITLE"),Joomla.renderMessages({warning:[r]}),!1}if(0==jQuery("#jform_seats_capacity").val()&&!jQuery("#jform_capacity_count").val())return!1;Joomla.submitform(e,document.getElementById("form-venue"))}"venueform.cancel"==e&&Joomla.submitform(e,document.getElementById("form-venue"))},getPluginParams:function(){var e=jQuery("#jform_online_provider").val(),t=jQuery("#form-venue");t.addClass("isloading"),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",datatype:"HTML",data:{async:"false",format:"",task:"venueform.getelementparams",element:e,venue_id:jQuery("#venue_id").val()}}).done((function(e){jQuery("#provider_html").html(e.data);var t=jQuery('input[name="jform[online]"]:checked').val();jQuery("#provider_html").css("display","none"),1==t&&(jQuery("#provider_html").css("display","block"),jQuery("#provider_html").trigger("subform-row-add",jQuery("#provider_html")))})).fail((function(e){return jQuery("#provider_html").hide(),Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),!0})).always((function(){jQuery("html, body").animate({scrollTop:jQuery("#provider_html").offset().top},1500);for(var e=document.getElementsByClassName("input-password-toggle"),o=0;o<e.length;o++)!function(t){e[t].addEventListener("click",(function(){"password"==jQuery(this).prev("input").attr("type")?jQuery(this).prev("input").attr("type","text"):jQuery(this).prev("input").attr("type","password")}))}(o);t.removeClass("isloading")})),googleMapApiKey&&google.maps.event.addDomListener(window,"load",(function(){input=document.getElementById("jform_address"),new google.maps.places.Autocomplete(input)}))},getLongitudeLatitude:function(){if(googleMapApiKey){var e=new google.maps.Geocoder,t=jQuery("#jform_address").val();e.geocode({address:t},(function(e,t){if(t==google.maps.GeocoderStatus.OK){var o=e[0].geometry.location.lat(),r=e[0].geometry.location.lng();jQuery("#jform_latitude").val(o),jQuery("#jform_longitude").val(r)}}))}},getCurrentLocation:function(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,o=e.coords.longitude;jQuery.ajax({type:"POST",url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=venueform.getLocation",data:"latitude="+t+"&longitude="+o,dataType:"json",success:function(e){console.log(e);var t=e.location,o=e.longitude,r=e.latitude;e&&(jQuery("#jform_address").val(t),jQuery("#jform_longitude").val(o),jQuery("#jform_latitude").val(r))}})}));else{var e=Joomla.JText._("COM_JTICKETING_ADDRESS_NOT_FOUND"),t=Joomla.JText._("COM_JTICKETING_LONG_LAT_VAL");jQuery("#jform_address").val(e),jQuery("#jform_longitude").val(t),jQuery("#jform_latitude").val(t)}}},event:{onlineMeetingUrl:function(e,t){if(null==t)t=jQuery("#event_id").val();var o=jQuery("#jt-enterMeeting");o.button("loading"),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{format:"",task:"event.onlineMeetingUrl",eventId:t,view:"event"}}).done((function(e){if(1==e.success){if(1==e.data)return void(top.location.href=Joomla.getOptions("system.paths").base+"/index.php?option=com_users&view=login");var t=window.open(e.data,"_blank");t?t.focus():(Joomla.renderMessages({notice:[Joomla.JText._("COM_JTICKETING_EVENTS_ENTER_MEETING_SITE_POPUPS")]}),jQuery("html, body").animate({scrollTop:0},"slow"))}else Joomla.renderMessages({error:[e.message]}),jQuery("html, body").animate({scrollTop:0},"slow")})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")})).always((function(){o.button("reset")}))},meetingRecordingUrl:function(e,t){if(null==t)t=jQuery("#event_id").val();JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{format:"",task:"event.meetingRecordingUrl",eventId:t,view:"event"}}).done((function(e){if(1==e.success){if(1==e.data)return void(top.location.href=Joomla.getOptions("system.paths").base+"/index.php?option=com_users&view=login");var t=window.open(e.data,"_blank");t?t.focus():(Joomla.renderMessages({notice:[Joomla.JText._("COM_JTICKETING_EVENTS_ENTER_MEETING_SITE_POPUPS")]}),jQuery("html, body").animate({scrollTop:0},"slow"))}else Joomla.renderMessages({error:[e.message]}),jQuery("html, body").animate({scrollTop:0},"slow")})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")})).always((function(){}))},initEventDetailJs:function(){jQuery(document).ready((function(){jQuery('[data-toggle="tooltip"]').tooltip(),jtCounter.jtCountDown("jt-countdown",startDate,endDate,currentDate),jtSite.event.onChangeGetOrderData(),1==guest&&(startDate=startDateUTC,endDate=endDateUTC),jtSite.event.localTime(startDate,endDate,guest),jQuery(".r-more").click((function(){var e=jQuery(this).closest(".long_desc"),t=jQuery(".long_desc_extend");t.appendTo(".description"),jQuery(e).hide(),jQuery(".r-more",e).hide(),jQuery(t).show(),jQuery(".r-less",t).show()})),jQuery(".r-less").click((function(){var e=jQuery(".long_desc_extend"),t=jQuery(".long_desc");jQuery(e).hide(),jQuery(".r-less",e).hide(),jQuery(".long_desc").show(),jQuery(".r-more",t).show(),jQuery("html, body").animate({scrollTop:0},"slow")}))}))},viewMoreAttendee:function(){var e=document.getElementById("event_id").value;0==gbl_jticket_pro_pic&&(gbl_jticket_pro_pic=document.getElementById("attendee_pro_pic_index").value),techjoomla.jQuery.ajax({url:jtRootURL+"index.php?option=com_jticketing&task=event.viewMoreAttendee&tmpl=component",type:"POST",dataType:"json",data:{eventId:e,jticketing_index:gbl_jticket_pro_pic},success:function(e){gbl_jticket_pro_pic=e.jticketing_index,techjoomla.jQuery("#jticketing_attendee_pic ").append(e.records),(!e.records||attedee_count<=gbl_jticket_pro_pic)&&techjoomla.jQuery("#btn_showMorePic").hide()},error:function(e){console.log("error")}})},loadActivity:function(){jQuery(window).on("load",(function(){"0"==jQuery("#tj-activitystream .feed-item-cover").length&&jQuery(".todays-activity .feed-item").css("border-left","0px"),jQuery("#postactivity").attr("disabled",!0),jQuery("#activity-post-text").on("input",(function(){""==jQuery("#activity-post-text").val()?jQuery("#postactivity").attr("disabled",!0):jQuery("#postactivity").attr("disabled",!1);var e=jQuery("#activity-post-text").attr("maxlength")-jQuery("#activity-post-text").val().length;jQuery("#activity-post-text-length").html(e+" "+Joomla.JText._("COM_JTICKETING_POST_TEXT_ACTIVITY_REMAINING_TEXT_LIMIT"))}))}))},onChangefun:function(){jQuery("#gallary_filter").change((function(){var e=document.getElementById("gallary_filter").value;if("1"==e){jQuery("#videos").show(),jQuery("#images").hide();const e=document.createElement("h5"),t=document.createTextNode(Joomla.JText._("COM_JTICKETING_GALLERY_VIDEO_TEXT"));e.appendChild(t),jQuery(".videosText").html(e),jQuery(".imagesText").hide()}else if("2"==e){jQuery("#videos").hide(),jQuery("#images").show();const e=document.createElement("h5"),t=document.createTextNode(Joomla.JText._("COM_JTICKETING_GALLERY_IMAGE_TEXT"));e.appendChild(t),jQuery(".videosText").html(e),jQuery(".imagesText").hide()}else if("0"==e){jQuery("#videos").show(),jQuery("#images").show();const e=document.createElement("h5"),t=document.createTextNode(Joomla.JText._("COM_JTICKETING_EVENT_VIDEOS"));e.appendChild(t),jQuery(".videosText").html(e),jQuery(".imagesText").show()}})).change()},eventImgPopup:function(e){jQuery("."+e).magnificPopup({delegate:"a",type:"image",tLoading:"Loading image #%curr%...",mainClass:"mfp-img-mobile",gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1]},image:{tError:'<a href="%url%">The image #%curr%</a> could not be loaded.',titleSrc:function(e){return e.el.attr("title")+"<small></small>"}}})},onChangeGetOrderData:function(){jQuery("#event-graph-period").change((function(){var e=jQuery("#event-graph-period").val(),t=jQuery("#event_id").val();techjoomla.jQuery.ajax({type:"GET",url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&view=event&task=event.getEventOrderGrapgData&eventId="+t+"&filtervalue="+e,dataType:"json",error:function(e){console.log("error")}}).done((function(e){var t=document.getElementById("myevent_graph").getContext("2d");new Chart(t,{type:"line",data:{labels:e.orderDate,datasets:[{label:e.totalOrdersAmount?e.totalOrdersAmount:0,data:e.orderAmount?e.orderAmount:0,backgroundColor:"rgba(203, 235, 230, 0.5)",borderColor:"rgba(55, 179, 142, 1)",lineTension:"0",borderWidth:"2",pointRadius:1,pointBackgroundColor:"rgba(55, 179, 142, 1)",pointBorderColor:"rgba(55, 179, 142, 1)",pointHoverBackgroundColor:"rgba(55, 179, 142, 1)",pointHoverBorderColor:"rgba(55, 179, 142, 1)"},{label:e.avgOrdersAmount?e.avgOrdersAmount:0,data:e.orderAvg?e.orderAvg:0,backgroundColor:"rgba(216, 225, 180, 1)",borderColor:"rgba(251, 214, 20, 0.90)",lineTension:"0",borderWidth:"2",pointRadius:1,pointBackgroundColor:"rgba(251, 214, 20, 0.90)",pointBorderColor:"rgba(251, 214, 20, 0.90)",pointHoverBackgroundColor:"rgba(251, 214, 20, 0.90)",pointHoverBorderColor:"rgba(251, 214, 20, 0.90)"}]}})}))})).change()},searchAttendee:function(){var e,t,o,r,a=0;for(e=document.getElementById("attendeeInput").value.toUpperCase(),t=document.getElementById("eventAttender").getElementsByTagName("tr"),r=0;r<t.length;r++)(o=t[r].getElementsByTagName("td")[1])&&(o.innerHTML.toUpperCase().indexOf(e)>-1?(t[r].style.display="",a+=1):t[r].style.display="none");a<5?jQuery("#btn_showMorePic").hide():jQuery("#btn_showMorePic").show()},localTime:function(e,t,o){e=new Date(e.replace(/-/g,"/"));e=jtSite.event.formatDate(e);t=new Date(t.replace(/-/g,"/"));t=jtSite.event.formatDate(t),1==o&&(e+=" UTC",t+=" UTC"),e=new Date(e.replace(/-/g,"/")),e=jtSite.event.formatTime(e),t=new Date(t.replace(/-/g,"/")),t=jtSite.event.formatTime(t);var r=(new Date).toString().match(/\(([A-Za-z\s].*)\)/)[1];jQuery(".time").html("("+Joomla.JText._("COM_JTICKETING_YOUR_TIME")+e+" - "+t+" "+r+")")},formatDate:function(e){var t=e.getHours(),o=e.getMinutes(),r=t>=12?"pm":"am",a=(t=(t%=12)||12)+":"+(o=o<10?"0"+o:o)+" "+r;return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()+" "+a},formatTime:function(e){var t=e.getHours(),o=e.getMinutes(),r=t>=12?"pm":"am";return(t=(t%=12)||12)+":"+(o=o<10?"0"+o:o)+" "+r}},order:{checkForAlpha:function(e){var t=0;for(t=0;t<e.value.length;t++)if(e.value.charCodeAt(t)>64&&e.value.charCodeAt(t)<92||e.value.charCodeAt(t)>96&&e.value.charCodeAt(t)<123){alert(Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS")),e.value=e.value.substring(0,t);break}if(e.value<0&&alert(Joomla.JText._("COM_JTICKETING_ENTER_AMOUNT_GR_ZERO")),e.value%1!=0)return alert(Joomla.JText._("COM_JTICKETING_ENTER_AMOUNT_INT")),e.value=0,!1},validateSpecialChar:function(e){var t=jQuery(e).val(),o="`~!@#$%^&*()_=+[]{}|;:'\",<.>/?";for(i=0;i<30;i++)if(t.indexOf(o[i])>-1)return jQuery(e).val(""),alert(Joomla.JText._("COM_JTICKETING_CHECK_SPECIAL_CHARS")),!1},jtShowFilter:function(){jQuery("#jthorizontallayout").toggle()},jticketingGenerateState:function(e,t,o){var r=jQuery("#"+e).val();if(null==r)return!1;JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=order.loadState&country="+r,type:"GET"}).done((function(o){!0===o.success&&jtSite.order.generateOption(o.data,e,t)})).fail((function(){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_ORDER_RELATED_AJAX_FAIL_ERROR_MESSAGE")]}),jQuery("html, body").animate({scrollTop:0},"slow")})),jQuery("select").trigger("chosen:updated"),jQuery("select").trigger("liszt:updated")},generateOption:function(e,t,o){var r,a;jQuery("#"+t).val();"country"==t&&(a=jQuery("#state"),defaultOption=Joomla.JText._("COM_JTICKETING_BILLIN_SELECT_STATE")),a.find("option").remove().end(),selected='selected="selected"';var n="<option "+selected+' value="">'+defaultOption+"</option>";if("country"==t&&jQuery("#state").append(n),null!=e)for(e,r=0;r<e.length;++r){selected="",name==o&&(selected='selected="selected"');var i=e[r];selected="",i.id==o&&(selected='selected="selected"');n="<option "+selected+' value="'+i.id+'">'+i.region+"</option>";jQuery("#state").append(n)}jQuery("select").trigger("chosen:updated"),jQuery("select").trigger("liszt:updated")},selectAttendee:function(e){var t=e.value;if(null==t||t<=0){var o=jQuery(e).parent().parent().parent().parent().find("div");return jQuery(o).find('input[id*="attendee_field_"],select[id*="attendee_field_"]').each((function(){switch(jQuery(this).attr("type")){case"checkbox":case"radio":break;default:jQuery(this).val("")}})),!1}jQuery(e).parent().parent().parent().find('input[id*="attendee_field_attendee_id"]').val(t),jQuery.ajax({url:jtRootURL+"?option=com_jticketing&format=json&task=order.selectAttendee&attendee_id="+t+"&tmpl=component&format=raw",type:"GET",dataType:"json",success:function(t){jQuery.each(t,(function(t,o){var r=jQuery(e).parent().parent().parent().find('input[id*="attendee_field_'+t+'"],select[id*="attendee_field_'+t+'"]');switch(r.attr("type")){case"checkbox":r.attr("checked","checked");break;case"radio":r.filter('[value="'+o+'"]').attr("checked","checked");break;default:r.val(o)}}))}})},verifyBookingID:function(){var e=document.getElementById("online_guest").value;jQuery.ajax({url:"index.php?option=com_jticketing&format=json&task=order.verifyBookingID",type:"POST",async:!1,data:{book_id:e},dataType:"json",success:function(e){e.success?window.location.href=e.host_url:alert(Joomla.JText._("JT_TICKET_BOOKING_ID_VALIDATION"))}})},getRegistrationType:function(e){jQuery("input[name='registration_type']").val(e),"0"==e&&(jQuery(".business_detail").hide(),jQuery("#registration_type1").removeClass("btn-success active"),jQuery("#registration_type0").addClass("btn-success active"),jQuery("#business_name").removeClass("required")),"1"==e&&(jQuery(".business_detail").show(),jQuery("#registration_type1").addClass("btn-success active"),jQuery("#registration_type0").removeClass("btn-success active"),jQuery("#business_name").addClass("required"))},gatewayHtml:function(e,t){var o='<button id="btnWizardPrev1" onclick="jQuery(\'#MyWizard\').wizard(\'previous\');" type="button" class="btn  btn-default  btn-prev pull-left" > <i class="icon-arrow-left" ></i>'+Joomla.JText._("COM_JTICKETING_PREV")+"</button>";jQuery.ajax({beforeSend:function(){jQuery("#jticketing-payHtmlDiv").addClass("isloading")},complete:function(){jQuery("#jticketing-payHtmlDiv").removeClass("isloading")},url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=payment.changegateway&gateways="+e+"&order_id="+t+"&tmpl=component",type:"POST",data:"",dataType:"json",success:function(e){!0===e.success&&(jQuery("#jticketing-payHtmlDiv").html(e.data),jQuery("#jticketing-payHtmlDiv div.form-actions").prepend(o),jQuery('#jticketing-payHtmlDiv div.form-actions input[type="submit"]').addClass("pull-right"),jQuery('#jticketing-payHtmlDiv div.form-actions input[type="submit"]').addClass("paymentButton"),1===ga_ec_analytics&&jQuery(".paymentButton").click((function(){var e=4;1===track_attendee_step&&(e=5),jtSite.order.addEcTrackingData(t,e)})))}})},jtLogin:function(){jQuery.ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=order.loginValidate&tmpl=component",type:"post",data:jQuery("#user-info-tab #login :input"),dataType:"json",beforeSend:function(){jQuery("#button-login").attr("disabled",!0),jQuery("#button-login").after('<span class="wait">&nbsp;Loading..</span>')},complete:function(){jQuery("#button-login").attr("disabled",!1),jQuery(".wait").remove()},success:function(e){jQuery(".warning, .j2error").remove(),e.error?(jQuery("#login").prepend('<div class="warning danger" >'+e.error.warning+'<button data-dismiss="alert" class="close" type="button">Ã—</button></div>'),jQuery(".warning").fadeIn("slow")):e.redirect&&!e.redirect_invoice_view?(jtSite.order.updateBillingDetails(),jQuery("#btnWizardNext").show()):e.redirect_invoice_view&&(document.location=e.redirect_invoice_view)},error:function(e,t,o){}})},updateBillingDetails:function(){jQuery("#btnWizardNext").removeAttr("disabled"),jQuery.ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=order.getUpdatedBillingInfo&tmpl=component",type:"post",data:jQuery("#user-info-tab #login :input"),dataType:"json",beforeSend:function(){},complete:function(){},success:function(e){e.error||e.billing_html&&(jQuery("#billing-info").html(e.billing_html),jtSite.order.jticketingGenerateState("country","",""),jQuery("#billing_info_data").show())},error:function(e,t,o){}})},paymentInit:function(){jQuery(document).ready((function(){1==count&&jtSite.order.gatewayHtml(gateWayName,orderId)}))},addEcTrackingData:function(e,t){"undefined"!=typeof tjanalytics&&JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=order.getEcTrackingData&orderId="+e+"&stepId="+t,type:"GET"}).done((function(e){tjanalytics.ga.addProduct(e.data),t>0?tjanalytics.ga.setAction(e.data[0]):tjanalytics.ga.setTransaction(e.data[0])})).fail((function(){return!0}))},validateAttendeeName:function(){var e=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;jQuery("#attendeeCheckout").click((function(){for(var t=0;;){var o="#attendee_field_3_";if(o=o.concat(t),!jQuery(o).length)break;if(jQuery(o).length&&""!=jQuery(o).val()&&!regexForAttendeeMob.test(jQuery(o).val())){var r=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_INVALID_ATTENDEE_MOB")+" "+(t+1);return Joomla.renderMessages({error:[r]}),jQuery("html, body").animate({scrollTop:0},"slow"),!1}var a="#attendee_field_4_";if(a=a.concat(t),jQuery(a).length&&""!=jQuery(a).val()&&!e.test(jQuery(a).val())){r=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_INVALID_ATTENDEE_EMAIL")+" "+(t+1);return Joomla.renderMessages({error:[r]}),jQuery("html, body").animate({scrollTop:0},"slow"),!1}t++}}))},hideEmailField:function(){jQuery("#ticketToBuyer").on("click",(function(){jQuery(".emailValidation").addClass("af-d-none"),jQuery(".emailValidation").parent().addClass("af-d-none"),jQuery(".emailValidation").removeClass("required"),jQuery(".emailValidation").removeAttr("required")})),jQuery("#ticketToAttendee").on("click",(function(){jQuery(".emailValidation").removeClass("af-d-none"),jQuery(".emailValidation").parent().removeClass("af-d-none"),jQuery(".emailValidation").addClass("required"),jQuery(".emailValidation").attr("required")}))}},orders:{initOrdersJs:function(){jQuery(document).ready((function(){jQuery(".jt_selectbox").attr("data-chosen","com_jticketing"),jQuery("input[name='gateways']").change((function(){var e=jQuery("input[name='gateways']:checked").val();jQuery("#html-container").empty().html("Loading..."),jQuery.ajax({url:jtRootURL+"index.php?option=com_jticketing&tmpl=component&task=orders.retryPayment&order="+orderID+"&gateway_name="+e,type:"GET",dataType:"json",success:function(e){jQuery("#html-container").removeClass("ajax-loading").html(e)}})}))})),Joomla.submitbutton=function(e){"cancel"==e&&Joomla.submitform(e,document.getElementById("adminForm"))}},selectStatusOrder:function(e,t,o){document.getElementById("order_id").value=e,document.getElementById("payment_status").value=o.value,document.getElementById("processor").value=t;var r=o.selectedIndex,a=o.options[r].value,n="",i="orders.save";if("RF"===a&&(n="REFUND"),"E"===a&&(n="FAILED"),"D"===a&&(n="DECLINE"),"CRV"===a&&(n="CANCEL_REVERSED"),"RV"===a&&(n="REVERSED"),"RF"===a||"E"===a||"D"===a||"CRV"===a||"RV"===a){var u="COM_JTICKETING_ORDER_STATUS_"+n,l=Joomla.JText._("COM_JTICKETING_ORDER_STATUS_MESSAGE1")+Joomla.JText._(u)+Joomla.JText._("COM_JTICKETING_ORDER_STATUS_MESSAGE2");if(!0!==confirm(l)){var s=jQuery(o).data("oldvalue");return jQuery(o).val(s),jQuery(o).trigger("liszt:updated"),jQuery(o).trigger("chosen:updated"),!1}Joomla.submitform(i,document.getElementById("adminForm"))}else Joomla.submitform(i,document.getElementById("adminForm"))},printDiv:function(){var e=document.getElementById("printDiv").innerHTML,t=document.body.innerHTML;document.body.innerHTML=e,window.print(),document.body.innerHTML=t},showPaymentGetways:function(){return"none"==document.getElementById("gatewaysContent").style.display&&(document.getElementById("gatewaysContent").style.display="block"),!1}},eventform:{initEventJs:function(){jQuery(window).on("load",(function(){jQuery("#jform_startdate, #jform_enddate, .time-hours , .time-minutes").on("change, blur",(function(){0===jQuery("#jform_venue")[0].length&&jtSite.eventform.venueDisplay()})),jtSite.eventform.showTicketCapacity()})),jQuery(document).ready((function(){jQuery("input[name='jform[online_events]']:checked").val();jQuery("#attendeefields .subform-repeatable-wrapper").length&&jQuery("#attendeefields .subform-repeatable-wrapper .subform-repeatable .btn-toolbar.hidden:first").removeClass("hidden");jQuery("input[name='jform[id]']").val();var e=jtSite.eventform.venueDisplay();jtSite.eventform.existingEvents(),jtSite.eventform.selectExistingEventOnload(),e.then((function(){jtSite.eventform.showLocation()})),jQuery("input[name='jform[online_events]']").change((function(){jtSite.eventform.venueDisplay(),jtSite.eventform.existingEvents()})),jQuery("#jform_venue").change((function(){jtSite.eventform.showLocation()})),jQuery(".venueCheck").change((function(){jtSite.eventform.selectExistingEvent(),jtSite.eventform.showTicketCapacity()})),jQuery(".existingEvent").change((function(){jtSite.eventform.existingEventSelection()})),jQuery(".group-add").on("click",(function(){setTimeout((function(){jtSite.eventform.showTicketAvailability()}),150)})),jQuery.each(mediaGallery,(function(e,t){tjMediaFile.previewFile(t,1)})),jQuery('input[type=radio][name="jform[venuechoice]"]').on("click",(function(){"existing"==jQuery('input[type=radio][name="jform[venuechoice]"]:checked').val()?jQuery("#existingEvent").show():jQuery("#existingEvent").hide()})),jQuery(document).on("subform-row-add",(function(e,t){jQuery("input.price").change((function(){var e=jtSite.eventform.getRoundedValue(this.value);if(e){jQuery(this.id).focus();var t="";return t+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+e,Joomla.renderMessages({warning:[t]}),!1}}))})),jQuery("input.price").change((function(){var e=jtSite.eventform.getRoundedValue(this.value);if(e){jQuery(this.id).focus();var t="";return t+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+e,Joomla.renderMessages({warning:[t]}),!1}})),jQuery("#jform_location").change((function(){if(googleMapLink){var e=new google.maps.Geocoder,t=jQuery("#jform_location").val();e.geocode({address:t},(function(e,t){if(t==google.maps.GeocoderStatus.OK){var o=e[0].geometry.location.lat(),r=e[0].geometry.location.lng();jQuery("#jform_latitude").val(o),jQuery("#jform_longitude").val(r)}}))}})),jtSite.eventform.displayNotices(ticketAccessState),jQuery(document).on("subform-row-add",(function(e,t){jtSite.eventform.displayNotices(ticketAccessState)}))})),Joomla.submitbutton=function(e){jQuery("#eventform-save").addClass("disabled"),"eventform.cancel"==e&&(jQuery("#eventform-save").removeClass("disabled"),Joomla.submitform(e,document.getElementById("adminForm")));var t=1;if(!document.formvalidator.isValid(document.getElementById("adminForm")))return jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top}),jQuery("#eventform-save").removeClass("disabled"),!1;var o=jtSite.eventform.getStartDate(),r=jtSite.eventform.getEndDate(),a=new Date(o),n=new Date(r),i=document.getElementById("jform_booking_start_date").value,u=document.getElementById("jform_booking_end_date").value,l=new Date(i),s=new Date(u),d=document.querySelector('input[name="jform[recurring_type]"]:checked')?.value||null;let m=jQuery('input[name="jform[repeat_via]"]:checked').val(),c=parseInt(document.getElementById("jform_repeat_count")?.value,10),_=document.getElementById("jform_repeat_until").value,j=parseInt(document.getElementById("jform_repeat_interval")?.value,10)||0;if(("eventform.save"==e||"eventform.save2new"==e||"eventform.apply"==e)&&eventId){var p=Number(new Date(oldEventStartDate)),y=Number(new Date(o)),v=Number(new Date(oldEventEndDate)),f=Number(new Date(r));if(p!=y||v!=f)if(1!=confirm(Joomla.JText._("COM_JTICKETING_SAVE_THE_EVENT_CHANGED_DATES")))return jQuery("#eventform-save").removeClass("disabled"),!1}var g=new Array;jQuery(".price").each((function(){let e=jQuery(this).val().isInteger?jQuery(this).val():Math.round(100*jQuery(this).val())/100;returnValue=jtSite.eventform.getRoundedValue(e),returnValue&&g.push(returnValue)}));var T=new Array;if(jQuery(".ticket-end-date").each((function(){var e=new Date(jQuery(this).val());"Invalid Date"!=e&&(""==u&&e>n?(jQuery(this.id).focus(),T.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_GREATER_EVENT_END_DATE_ERROR"))):"Invalid Date"!=s&&e>s&&(jQuery(this.id).focus(),T.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_GREATER_BOOKING_END_DATE_ERROR"))),""==i&&e<new Date?(jQuery(this.id).focus(),T.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_LESS_EVENT_MODIFICATION_DATE_ERROR"))):"Invalid Date"!=l&&e<l&&(jQuery(this.id).focus(),T.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_LESS_BOOKING_START_DATE_ERROR"))))})),o&&i){var E=new Date(o);new Date(i)>E&&(jQuery("jform_startdate").focus(),T.push(Joomla.JText._("COM_JTICKETING_BOOKING_START_DATE_WITH_EVENT_DATE_ERROR")))}if("eventform.save"==e){if(selectedVenueDetails){var h=0;if(techjoomla.jQuery("input.avail").each((function(){console.log(parseInt(techjoomla.jQuery(this).val())),h+=parseInt(techjoomla.jQuery(this).val())})),h>selectedVenueDetails.capacity_count)return alert(Joomla.JText._("COM_JTICKETING_VENUE_CAPACITY_ERROR")),jQuery("#eventform-save").removeClass("disabled"),!1}if(1==tncForCreateEvent&&!1===document.getElementById("accept_privacy_term").checked)return alert(Joomla.JText._("COM_JTICKETING_PRIVACY_TERMS_AND_CONDITIONS_ERROR")),jQuery("#eventform-save").removeClass("disabled"),!1;if(0!=T.length){var Q="";for(index=0;index<T.length;++index)Q+=T[index]+"<br>";return Joomla.renderMessages({warning:[Q]}),!1}if(0!=g.length)jQuery(g).each((function(){var e="";return e+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+g,Joomla.renderMessages({warning:[e]}),jQuery("#eventform-save").removeClass("disabled"),!1}));else if("No_repeat"!==d&&"rep_count"===m&&(isNaN(c)||c<1)){Q="";Q+="<br />"+Joomla.JText._(isNaN(c)||""===c?"COM_JTICKETING_FORM_LBL_REPEAT_COUNT_REQUIRED":"COM_JTICKETING_FORM_LBL_REPEAT_COUNT_INVALID"),Joomla.renderMessages({warning:[Q]})}else if("rep_until"===m&&(!_||""===_.trim()||new Date(_)<new Date(o))){Q="";Q+="<br />"+Joomla.JText._(_&&""!==_.trim()?"COM_JTICKETING_ERROR_REPEAT_UNTIL_GREATER_THAN_STARTDATE":"COM_JTICKETING_FORM_LBL_REPEAT_UNTIL_REQUIRED"),Joomla.renderMessages({warning:[Q]})}else if(isNaN(j)||j<0){Q="";Q+="<br />"+Joomla.JText._(isNaN(j)||""===j?"COM_JTICKETING_FORM_LBL_REPEAT_INTERVAL_REQUIRED":"COM_JTICKETING_FORM_LBL_REPEAT_INTERVAL_INVALID"),Joomla.renderMessages({warning:[Q]})}else if("No_repeat"===d&&n<=a){Q="";Q+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_DATE_ERROR"),Joomla.renderMessages({warning:[Q]})}else if("Invalid Date"!=l&&"Invalid Date"!=s&&s<=l){Q="";Q+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_BOOKING_DATE_ERROR"),Joomla.renderMessages({warning:[Q]})}else if("Invalid Date"!=s&&n<s){Q="";Q+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_BOOKING_EVENT_END_ERROR"),Joomla.renderMessages({warning:[Q]})}else{for(var I=0;;){var C="#jform_tickettypes__tickettypes"+I+"__unlimited_seats",J=0,O="#jform_tickettypes__tickettypes"+I+"__available";if(!jQuery(C).length)break;if(0==jQuery(C).val()&&(jQuery(O).val()<=0||!/^\d+$/.test(jQuery(O).val()))){J=1;Q="";Q=Joomla.JText._("COM_JTICKETING_ERROR")+"<br>"+Joomla.JText._("COM_JTICKETING_INVALID_SEAT_COUNT_ERROR"),Joomla.renderMessages({warning:[Q]}),jQuery(O).css("border-color","red"),jQuery(O).focus();break}I++}jQuery("#tickettypes .subform-repeatable-group").each((function(e){var o=jQuery(this);if((0==o.find("select.unlimited-seats").val()||"0"==o.find("select.unlimited-seats").val())&&!o.find("input.avail").val()){var r=Joomla.JText._("COM_JTICKETING_ENTER_VALID_SEAT_COUNT_FOR_TICKET")+" "+o.find("input.title").val();alert(r),t=0}})),jQuery("#accept_privacy_term").length&&1!=jQuery("#accept_privacy_term").prop("checked")&&(alert(Joomla.JText._("COM_JTICKETING_PRIVACY_TERMS_AND_CONDITIONS_ERROR")),t=0),1==document.formvalidator.isValid(document.getElementById("adminForm"))&&0==J&&Joomla.submitform(e,document.getElementById("adminForm")),1==t&&Joomla.submitform(e,document.getElementById("adminForm"))}}else Joomla.submitform(e,document.getElementById("adminForm"));jQuery("#eventform-save").removeClass("disabled")}},getRoundedValue:function(e){var t="";return jQuery.ajax({type:"POST",dataType:"json",data:{price:e},async:!1,url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=eventform.getRoundedValue&price="+e,success:function(o){if(o.data==e)return e;roundedPrice=o.data,t=Joomla.JText._("COM_JTICKETING_VALIDATE_ROUNDED_PRICE").concat(roundedPrice)}}),t},showLocation:function(){var e=parseInt(jQuery("#jform_venue").val()),t=jQuery("input[name='jform[online_events]']:checked").val();if(0==parseInt(enableOnlineVenues))selectedVenue>0&&0===e?(jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required")):selectedVenue>0||0!=e&&e?(jQuery("#event-location").hide(),jQuery("#jform_location").prop("required",!1),jQuery("#jform_location").removeClass("required")):(jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required"));else if(selectedVenue>0&&!e)jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required");else if(0==e&&"0"===t)jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required");else if(e||"0"!==t)jQuery("#event-location").hide(),jQuery("#jform_location").prop("required",!1),jQuery("#jform_location").removeClass("required");else{jQuery("#foorm_venue").val();jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required")}},getStartDate:function(){return document.getElementById("jform_eventstart_date").value+" "+document.getElementById("jform_start_time").value},getEndDate:function(){let e=document.getElementById("jform_eventstart_date").value+" "+document.getElementById("jform_start_time").value,t=jQuery('input[name="jform[repeat_via]"]:checked').val(),o=jQuery('input[name="jform[recurring_type]"]:checked').val(),r=parseInt(document.getElementById("jform_repeat_count")?.value,10)-1,a=document.getElementById("jform_repeat_until").value+" "+document.getElementById("jform_end_time").value,n=parseInt(document.getElementById("jform_repeat_interval")?.value,10)||0,i=new Date(e),u=new Date(i);if("rep_until"===t)return a;if(!("rep_count"===t&&r>=0))return document.getElementById("jform_eventend_date").value+" "+document.getElementById("jform_end_time").value;switch(o){case"Daily":0===n?u.setDate(i.getDate()+r):u.setDate(i.getDate()+r*(n+1));break;case"Weekly":0===n?u.setDate(i.getDate()+7*r):u.setDate(i.getDate()+r*(7*(n+1)));break;case"Monthly":0===n?u.setMonth(i.getMonth()+r):u.setMonth(i.getMonth()+r*(n+1));break;case"Yearly":0===n?u.setFullYear(i.getFullYear()+r):u.setFullYear(i.getFullYear()+r*(n+1));break;default:return document.getElementById("jform_eventend_date").value+" "+document.getElementById("jform_end_time").value}return u.toISOString().split("T")[0]+" "+u.toTimeString().split(" ")[0]},venueDisplay:function(){return new Promise((function(e,t){var o=jQuery("input[name='jform[online_events]']:checked").val(),r=jtSite.eventform.getStartDate(),a=jtSite.eventform.getEndDate();if(1==silentVendor)var n=jQuery("input[name='jform[created_by]']").val();var i=jQuery("input[name='jform[online_events]']:checked").val();jQuery("#jform_venue").val();"1"==i?(jQuery("#event-location").hide(),jQuery("#venuechoice_id").show(),jQuery("#existingEvent").show()):(jQuery("#venuechoice_id").hide(),jQuery("#existingEvent").hide());var u={};u.radioValue=o,u.eventStartTime=r,u.eventEndTime=a,u.silentVendor=silentVendor,u.eventId=eventId,u.venueId=venueId,0==silentVendor?u.vendor_id=vendor_id:u.created_by=n,jQuery("#jform_venue, .chzn-results").empty(),JSON.stringify(u),jQuery.ajax({type:"POST",data:u,dataType:"json",url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=eventform.getVenueList",success:function(t){if(""==t&&0==eventId&&1==o){jQuery("#jform_venue").prop("disabled",!0);var r="<option value='0' selected='selected'>"+Joomla.JText._("COM_JTICKETING_NO_ONLINE_VENUE_ERROR")+"</option>";jQuery("#jform_venue").append(r),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated");var a="";a+="<br />"+Joomla.JText._("COM_JTICKETING_NO_VENUE_ERROR_MSG"),Joomla.renderMessages({warning:[a]})}else if(0!=eventId){1==jQuery("input[name='jform[online_events]']:checked").val()&&jQuery("#jform_venue").prop("disabled",!0),0==venueId&&(jQuery("#jform_venue, .chzn-results").empty(),venueName=Joomla.JText._("COM_JTICKETING_CUSTOM_LOCATION"));r="<option value='"+venueId+"' selected='selected'>"+venueName+" </option>";for(jQuery("#jform_venue").append(r),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated"),index=0;index<t.length;++index){r="<option value='"+t[index].value+"' > "+t[index].text+"</option>";jQuery("#jform_venue").append(r),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated")}}else{jQuery("#jform_venue").prop("disabled",!1);r="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_EVENT_DEFAULT_VENUE_OPTION")+"</option>";for(jQuery("#jform_venue").append(r),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated"),index=0;index<t.length;++index){r="<option value='"+t[index].value+"' > "+t[index].text+"</option>";jQuery("#jform_venue").append(r),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated")}}e()}})}))},ConvertTimeformat:function(e,t,o,r){t=parseInt(t),"PM"==r&&t<12&&(t+=12),"AM"==r&&12==t&&(t-=12),t<10&&(t="0"+t),(o=parseInt(o))<10&&(o="0"+o);var a=new Date(e+" "+t+":"+o+":00").toISOString();return(a=a.substring(0,a.length-5)).replace("T"," ")},existingEvents:function(){var e=jQuery("input[name='jform[online_events]']:checked").val();"new"==jQuery("input[name='jform[venuechoice]']:checked").val()&&"1"==e?jQuery("#form_existingEvent").hide():jQuery("#form_existingEvent").show()},selectExistingEvent:function(){var e=document.getElementById("jform_venue").value,t=jQuery('input[type=radio][name="jform[online_events]"]:checked').val();jQuery("#jform_existing_event option").remove();var o=jQuery("#jform_existing_event"),r="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_SELECT_EXISTING_EVENT_OPTION")+"</option>";o.append(r),o.trigger("liszt:updated"),o.trigger("chosen:updated"),"0"!=e&&"1"==t&&JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"eventform.getAllMeetings",venueId:e}}).done((function(e){if(!0===e.success){var t=e.data;null!=t&&Array.isArray(t)&&t.forEach((function(e){r=existing_url==e.id?"<option value='"+e.id+"' selected='selected'>"+e.title+" ("+e.start_time+")</option>":"<option value='"+e.id+"' >"+e.title+" ("+e.start_time+")</option>",o.append(r)}))}})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_EVENT_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){o.trigger("liszt:updated"),o.trigger("chosen:updated")}))},selectExistingEventOnload:function(){if(!existing_url){var e=jQuery('input[type=radio][name="jform[online_events]"]:checked').val();jQuery("#jform_existing_event option").remove();var t=jQuery("#jform_existing_event"),o="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_SELECT_EXISTING_EVENT_OPTION")+"</option>";t.append(o),t.trigger("liszt:updated"),t.trigger("chosen:updated"),"0"!=venueId&&"1"==e&&JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"eventform.getAllMeetings",venueId:venueId}}).done((function(e){if(!0===e.success){var r=e.data;null!=r&&Array.isArray(r)&&r.forEach((function(e){o=existing_url==e.id?"<option value='"+e.id+"' selected='selected'>"+e.title+" ("+e.start_time+")</option>":"<option value='"+e.id+"' >"+e.title+" ("+e.start_time+")</option>",t.append(o)}))}})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_EVENT_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){t.trigger("liszt:updated"),t.trigger("chosen:updated")}))}},existingEventSelection:function(){var e=jQuery("input[name='jform[online_events]']:checked").val();"new"==jQuery("input[name='jform[venuechoice]']:checked").val()&&"1"==e?jQuery("#form_existingEvent").hide():jQuery("#form_existingEvent").show()},displayNotices:function(e){"exclude"==e?jQuery(".accessNote").html(Joomla.JText._("COM_JTICKETING_TICKET_ACCESS_EXCLUDE")):jQuery(".accessNote").html(Joomla.JText._("COM_JTICKETING_TICKET_ACCESS_INCLUDE"))},showTicketCapacity:function(){var e=parseInt(jQuery("#jform_venue").val());if(techjoomla.jQuery(".ticketCapacityNote").addClass("af-d-none"),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!1),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),e){var t={};t.venue=e,JSON.stringify(t),jQuery.ajax({type:"POST",dataType:"json",data:t,url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=venueform.getCapacity",success:function(e){e&&(e.data&&0==e.data.seats_capacity?(techjoomla.jQuery(".unlimited-seats").each((function(){techjoomla.jQuery(this).val()||techjoomla.jQuery(this).val("")})),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!0),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),techjoomla.jQuery(".ticketCapacityNote").removeClass("af-d-none"),techjoomla.jQuery(".ticketCapacityNote").html(Joomla.JText._("COM_JTICKETING_TICKET_CAPACITY_ALERT")+e.data.capacity_count),selectedVenueDetails=e.data):(1==e.data&&alert(e.message),selectedVenueDetails=""))}})}else selectedVenueDetails=""},showTicketAvailability:function(){(jQuery("#jform_venue").val()?parseInt(jQuery("#jform_venue").val()):0)&&selectedVenueDetails&&(techjoomla.jQuery(".unlimited-seats").each((function(){techjoomla.jQuery(this).val()||techjoomla.jQuery(this).val("")})),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!0),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),techjoomla.jQuery(".ticketCapacityNote").removeClass("af-d-none"),techjoomla.jQuery(".ticketCapacityNote").html(Joomla.JText._("COM_JTICKETING_TICKET_CAPACITY_ALERT")+selectedVenueDetails.capacity_count))}},couponform:{initCouponFormJs:function(){jQuery(document).ready((function(){jQuery("#jform_value").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS")),jQuery("#couponform #jform_val_type").length&&"1"==jQuery("#couponform #jform_val_type").val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100&&(alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""))})),jQuery("#couponform #jform_val_type").change((function(){jQuery("#couponform #jform_val_type").length&&"1"==jQuery("#couponform #jform_val_type").val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100&&(alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""))}));var e=jQuery("#group_discount_tickets_container");"1"!==jQuery("input[name='jform[group_discount]']:checked").val()&&e.addClass("d-none"),jQuery('input[name="jform[group_discount]"]').change((function(){e.toggleClass("d-none","1"!==jQuery(this).val())})),jQuery("#jform_limit").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS"))})),jQuery("#jform_max_per_user").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS"))}))}))},couponSubmitButton:function(e){if(jQuery("#couponform #jform_val_type").length&&"1"==jQuery("#couponform #jform_val_type").val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100)return alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""),!1;("couponform.cancel"==e||"couponform.cancel"!=e&&document.formvalidator.isValid(document.getElementById("coupon-form")))&&Joomla.submitform(e,document.getElementById("coupon-form"))}},coupons:{couponsSubmitData:function(e){if("coupons.delete"==e&&!0!==confirm(Joomla.JText._("COM_JTICKETING_ARE_YOU_SURE_YOU_TO_DELETE_THE_COUPON")))return;Joomla.submitform(e)}},myEvents:{myEventsSubmitData:function(e){"eventform.add"!=e&&0==document.adminForm.boxchecked.value?alert(Joomla.Text._("TJTOOLBAR_NO_SELECT_MSG")):Joomla.submitform(e)}}},jtAdmin={event:{initEventJs:function(){jQuery(window).on("load",(function(){jQuery("#jform_startdate, #jform_enddate, .time-hours , .time-minutes").on("change, blur",(function(){0===jQuery("#jform_venue")[0].length&&jtSite.eventform.venueDisplay()})),jtAdmin.event.showTicketCapacity()})),jQuery(document).ready((function(){jQuery("input[name='jform[online_events]']:checked").val(),document.getElementById("jform_id").value;jQuery("#attendeefields .subform-repeatable-wrapper").length&&jQuery("#attendeefields .subform-repeatable-wrapper .subform-repeatable .btn-toolbar.hidden:first").removeClass("hidden");var e=jtAdmin.event.venueDisplay();jtAdmin.event.existingEvents(),e.then((function(){jtAdmin.event.showLocation()})),jtAdmin.event.selectExistingEventOnload(),jQuery("input[name='jform[online_events]']").change((function(){jtAdmin.event.venueDisplay(),jtAdmin.event.existingEvents(),jtAdmin.event.showTicketCapacity()})),jQuery(".group-add").on("click",(function(){setTimeout((function(){jtAdmin.event.showTicketAvailability()}),150)})),jQuery.each(mediaGallery,(function(e,t){tjMediaFile.previewFile(t,1)})),jQuery("#jform_venue").change((function(){jtAdmin.event.showLocation()})),jQuery(".venueCheck").change((function(){jtAdmin.event.selectExistingEvent(),jtAdmin.event.showTicketCapacity()})),jQuery(".existingEvent").change((function(){jtAdmin.event.existingEventSelection()})),jQuery("#jform_created_by").change((function(){jtAdmin.event.checkUserEmail()})),jQuery('input[type=radio][name="jform[venuechoice]"]').on("click",(function(){"existing"==jQuery('input[type=radio][name="jform[venuechoice]"]:checked').val()?jQuery("#existingEvent").show():jQuery("#existingEvent").hide()})),jQuery(document).on("subform-row-add",(function(e,t){jQuery("input.price").change((function(){var e=jtAdmin.event.getRoundedValue(this.value);if(e){jQuery(this.id).focus();var t="";return t+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+e,Joomla.renderMessages({warning:[t]}),!1}}))})),jQuery("input.price").change((function(){var e=jtAdmin.event.getRoundedValue(this.value);if(e){jQuery(this.id).focus();var t="";return t+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+e,Joomla.renderMessages({warning:[t]}),!1}})),jQuery("#jform_location").change((function(){if(googleMapApiKey){var e=new google.maps.Geocoder,t=jQuery("#jform_location").val();e.geocode({address:t},(function(e,t){if(t==google.maps.GeocoderStatus.OK){var o=e[0].geometry.location.lat(),r=e[0].geometry.location.lng();jQuery("#jform_latitude").val(o),jQuery("#jform_longitude").val(r)}}))}})),jtSite.eventform.displayNotices(ticketAccessState),jQuery(document).on("subform-row-add",(function(e,t){jtSite.eventform.displayNotices(ticketAccessState)}))})),Joomla.submitbutton=function(e){if(jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").addClass("disabled"),"event.cancel"==e)jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),Joomla.submitform(e,document.getElementById("adminForm"));else{if(!document.formvalidator.isValid(document.getElementById("adminForm")))return jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top}),jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1;if(jQuery("#accept_privacy_term").length&&1!=jQuery("#accept_privacy_term").prop("checked"))return alert(Joomla.JText._("COM_JTICKETING_PRIVACY_TERMS_AND_CONDITIONS_ERROR")),jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1}var t=jtAdmin.event.getStartDate(),o=jtAdmin.event.getEndDate(),r=new Date(t),a=new Date(o),n=document.getElementById("jform_booking_start_date").value,i=document.getElementById("jform_booking_end_date").value,u=new Date(n),l=new Date(i),s=document.querySelector('input[name="jform[recurring_type]"]:checked')?.value||null;let d=jQuery('input[name="jform[repeat_via]"]:checked').val(),m=parseInt(document.getElementById("jform_repeat_count")?.value,10),c=document.getElementById("jform_repeat_until").value,_=parseInt(document.getElementById("jform_repeat_interval")?.value,10)||0;if(("event.save"==e||"event.save2new"==e||"event.apply"==e)&&"0"!=document.getElementById("jform_id").value){var j=Number(new Date(oldEventStartDate)),p=Number(new Date(t)),y=Number(new Date(oldEventEndDate)),v=Number(new Date(o));if(j!=p||y!=v)if(1!=confirm(Joomla.JText._("COM_JTICKETING_SAVE_THE_EVENT_CHANGED_DATES")))return jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1}var f=new Array;jQuery(".price").each((function(){let e=jQuery(this).val().isInteger?jQuery(this).val():Math.round(100*jQuery(this).val())/100;returnValue=jtAdmin.event.getRoundedValue(e),returnValue&&f.push(returnValue)}));var g=new Array;if(jQuery(".ticket-end-date").each((function(){var e=new Date(jQuery(this).val());"Invalid Date"!=e&&(""==i&&e>a?(jQuery(this.id).focus(),g.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_GREATER_EVENT_END_DATE_ERROR"))):"Invalid Date"!=l&&e>l&&(jQuery(this.id).focus(),g.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_GREATER_BOOKING_END_DATE_ERROR"))),""==n&&e<new Date?(jQuery(this.id).focus(),g.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_LESS_EVENT_MODIFICATION_DATE_ERROR"))):"Invalid Date"!=u&&e<u&&(jQuery(this.id).focus(),g.push(Joomla.JText._("COM_JTICKETING_TICKET_END_DATE_LESS_BOOKING_START_DATE_ERROR"))))})),t&&n){var T=new Date(t);new Date(n)>T&&(jQuery("jform_startdate").focus(),g.push(Joomla.JText._("COM_JTICKETING_BOOKING_START_DATE_WITH_EVENT_DATE_ERROR")))}if("event.save"==e||"event.save2new"==e||"event.apply"==e){if(1==tncForCreateEvent&&!1===document.getElementById("accept_privacy_term").checked)return alert(Joomla.JText._("COM_JTICKETING_PRIVACY_TERMS_AND_CONDITIONS_ERROR")),jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1;if(selectedVenueDetails){var E=0;if(techjoomla.jQuery("input.avail").each((function(){E+=parseInt(techjoomla.jQuery(this).val())})),E>selectedVenueDetails.capacity_count)return alert(Joomla.JText._("COM_JTICKETING_VENUE_CAPACITY_ERROR")),jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1}if(0!=g.length){var h="";for(index=0;index<g.length;++index)h+=g[index]+"<br>";return Joomla.renderMessages({warning:[h]}),!1}if(0!=f.length)jQuery(f).each((function(){var e="";return e+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+f,Joomla.renderMessages({warning:[e]}),jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled"),!1}));else if("No_repeat"!==s&&"rep_count"===d&&(isNaN(m)||m<1)){h="";h+="<br />"+Joomla.JText._(isNaN(m)||""===m?"COM_JTICKETING_FORM_LBL_REPEAT_COUNT_REQUIRED":"COM_JTICKETING_FORM_LBL_REPEAT_COUNT_INVALID"),Joomla.renderMessages({warning:[h]})}else if("rep_until"===d&&(!c||""===c.trim()||new Date(c)<new Date(t))){h="";h+="<br />"+Joomla.JText._(c&&""!==c.trim()?"COM_JTICKETING_ERROR_REPEAT_UNTIL_GREATER_THAN_STARTDATE":"COM_JTICKETING_FORM_LBL_REPEAT_UNTIL_REQUIRED"),Joomla.renderMessages({warning:[h]})}else if(isNaN(_)||_<0){h="";h+="<br />"+Joomla.JText._(isNaN(_)||""===_?"COM_JTICKETING_FORM_LBL_REPEAT_INTERVAL_REQUIRED":"COM_JTICKETING_FORM_LBL_REPEAT_INTERVAL_INVALID"),Joomla.renderMessages({warning:[h]})}else if("No_repeat"===s&&a<=r){h="";h+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_DATE_ERROR"),Joomla.renderMessages({warning:[h]})}else if("Invalid Date"!=u&&"Invalid date"!=l&&l<=u){h="";h+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_BOOKING_DATE_ERROR"),Joomla.renderMessages({warning:[h]})}else if("Invalid date"!=l&&a<l){h="";h+="<br />"+Joomla.JText._("COM_JTICKETING_FORM_LBL_EVENT_BOOKING_EVENT_END_ERROR"),Joomla.renderMessages({warning:[h]})}else{for(var Q=0;;){var I="#jform_tickettypes__tickettypes"+Q+"__unlimited_seats",C=0,J="#jform_tickettypes__tickettypes"+Q+"__available";if(!jQuery(I).length)break;if(0==jQuery(I).val()&&(jQuery(J).val()<=0||!/^\d+$/.test(jQuery(J).val()))){C=1;h="";h+=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+": "+Joomla.JText._("COM_JTICKETING_INVALID_SEAT_COUNT_ERROR"),Joomla.renderMessages({warning:[h]}),jQuery(J).focus();break}Q++}1==document.formvalidator.isValid(document.getElementById("adminForm"))&&0==C&&(jtAdmin.event.showLocation(),Joomla.submitform(e,document.getElementById("adminForm")))}}else Joomla.submitform(e,document.getElementById("adminForm"));jQuery("#toolbar-apply, #toolbar-save, #toolbar-save-new").removeClass("disabled")}},showLocation:function(){var e=parseInt(jQuery("#jform_venue").val()),t=jQuery("input[name='jform[online_events]']:checked").val();if(0==parseInt(enableOnlineVenues))selectedVenue>0&&0===e?(jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required")):selectedVenue>0||0!=e&&e?(jQuery("#event-location").hide(),jQuery("#jform_location").prop("required",!1),jQuery("#jform_location").removeClass("required")):(jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required"));else if(selectedVenue>0&&!e)jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required");else if(0==e&&"0"===t)jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required");else if(e||"0"!==t)jQuery("#event-location").hide(),jQuery("#jform_location").prop("required",!1),jQuery("#jform_location").removeClass("required");else{jQuery("#jform_venue").val();jQuery("#event-location").show(),jQuery("#jform_location").prop("required",!0),jQuery("#jform_location").addClass("required")}},showTicketCapacity:function(){var e=parseInt(jQuery("#jform_venue").val());if(techjoomla.jQuery(".ticketCapacityNote").addClass("af-d-none"),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!1),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),e){var t={};t.venue=e,JSON.stringify(t),jQuery.ajax({type:"POST",dataType:"json",data:t,url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task=venue.getCapacity",success:function(e){e&&(e.data&&0==e.data.seats_capacity?(techjoomla.jQuery(".unlimited-seats").each((function(){techjoomla.jQuery(this).val()||techjoomla.jQuery(this).val("")})),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!0),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),techjoomla.jQuery(".ticketCapacityNote").removeClass("af-d-none"),techjoomla.jQuery(".ticketCapacityNote").html(Joomla.JText._("COM_JTICKETING_TICKET_CAPACITY_ALERT")+e.data.capacity_count),selectedVenueDetails=e.data):(1==e.data&&alert(e.message),selectedVenueDetails=""))}})}else selectedVenueDetails=""},showTicketAvailability:function(){(jQuery("#jform_venue").val()?parseInt(jQuery("#jform_venue").val()):0)&&selectedVenueDetails&&(techjoomla.jQuery(".unlimited-seats").each((function(){techjoomla.jQuery(this).val()||techjoomla.jQuery(this).val("")})),techjoomla.jQuery(".unlimited-seats option[value='1']").prop("disabled",!0),jQuery(".unlimited-seats").trigger("liszt:updated"),jQuery(".unlimited-seats").trigger("chosen:updated"),techjoomla.jQuery(".ticketCapacityNote").removeClass("af-d-none"),techjoomla.jQuery(".ticketCapacityNote").html(Joomla.JText._("COM_JTICKETING_TICKET_CAPACITY_ALERT")+selectedVenueDetails.capacity_count))},checkUserEmail:function(){var e=document.getElementById("jform_created_by_id").value,t={};t.user=e,JSON.stringify(t),jQuery.ajax({type:"POST",dataType:"json",data:t,url:"index.php?option=com_jticketing&format=json&task=event.checkUserEmail",success:function(e){jQuery("#warning_message").empty(),e.check&&(1!=array_check&&1!=handle_transactions||jQuery("#warning_message").html('<div class="alert alert-warning">'+Joomla.JText._("COM_JTICKETING_PAYMENT_DETAILS_ERROR_MSG1")+'<a href= "index.php?option=com_tjvendors&view=vendor&layout=update&client=com_jticketing&vendor_id='+e.vendor_id+'" target="_blank">'+Joomla.JText._("COM_JTICKETING_VENDOR_FORM_LINK")+"</a>"+Joomla.JText._("COM_JTICKETING_PAYMENT_DETAILS_ERROR_MSG2")))}})},getRoundedValue:function(e){var t="";return jQuery.ajax({type:"POST",dataType:"json",data:{price:e},async:!1,url:"index.php?option=com_jticketing&format=json&task=event.getRoundedValue&price="+e,success:function(o){if(o.data==e)return e;roundedPrice=o.data,t=Joomla.JText._("COM_JTICKETING_VALIDATE_ROUNDED_PRICE").concat(roundedPrice)}}),t},getStartDate:function(){return document.getElementById("jform_eventstart_date").value+" "+document.getElementById("jform_start_time").value},getEndDate:function(){let e=document.getElementById("jform_eventstart_date").value+" "+document.getElementById("jform_start_time").value,t=jQuery('input[name="jform[repeat_via]"]:checked').val(),o=jQuery('input[name="jform[recurring_type]"]:checked').val(),r=parseInt(document.getElementById("jform_repeat_count")?.value,10)-1,a=document.getElementById("jform_repeat_until").value+" "+document.getElementById("jform_end_time").value,n=parseInt(document.getElementById("jform_repeat_interval")?.value,10)||0,i=new Date(e),u=new Date(i);if("rep_until"===t)return a;if(!("rep_count"===t&&r>=0))return document.getElementById("jform_eventend_date").value+" "+document.getElementById("jform_end_time").value;switch(o){case"Daily":0===n?u.setDate(i.getDate()+r):u.setDate(i.getDate()+r*(n+1));break;case"Weekly":0===n?u.setDate(i.getDate()+7*r):u.setDate(i.getDate()+r*(7*(n+1)));break;case"Monthly":0===n?u.setMonth(i.getMonth()+r):u.setMonth(i.getMonth()+r*(n+1));break;case"Yearly":0===n?u.setFullYear(i.getFullYear()+r):u.setFullYear(i.getFullYear()+r*(n+1));break;default:return document.getElementById("jform_eventend_date").value+" "+document.getElementById("jform_end_time").value}return u.toISOString().split("T")[0]+" "+u.toTimeString().split(" ")[0]},venueDisplay:function(){return new Promise((function(e,t){var o=jQuery("input[name='jform[online_events]']:checked").val(),r=jtAdmin.event.getStartDate(),a=jtAdmin.event.getEndDate(),n=document.getElementById("jform_created_by_id").value,i=jQuery("input[name='jform[online_events]']:checked").val();jQuery("#jform_venue").val();"1"==i?(jQuery("#event-location").hide(),jQuery("#venuechoice_id").show(),jQuery("#existingEvent").show()):(jQuery("#venuechoice_id").hide(),jQuery("#existingEvent").hide());var u={};u.radioValue=o,u.eventStartTime=r,u.eventEndTime=a,u.created_by=n,u.eventId=eventId,u.venueId=venueId,jQuery("#jform_venue, .chzn-results").empty(),JSON.stringify(u),jQuery.ajax({type:"POST",data:u,dataType:"json",url:"index.php?option=com_jticketing&format=json&task=event.getVenueList",success:function(t){if(""==t&&0==eventId&&1==o){jQuery("#jform_venue").prop("disabled",!0);var r="<option value='0' selected='selected'>"+Joomla.JText._("COM_JTICKETING_NO_ONLINE_VENUE_ERROR")+"</option>";jQuery("#jform_venue").append(r),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated");var a="";a+="<br />"+Joomla.JText._("COM_JTICKETING_NO_VENUE_ERROR_MSG"),Joomla.renderMessages({warning:[a]})}else if(0!=eventId){1==jQuery("input[name='jform[online_events]']:checked").val()&&jQuery("#jform_venue").prop("disabled",!0),0==venueId&&(jQuery("#jform_venue, .chzn-results").empty(),venueName=Joomla.JText._("COM_JTICKETING_CUSTOM_LOCATION"));r="<option value='"+venueId+"' selected='selected'>"+venueName+" </option>";for(jQuery("#jform_venue").append(r),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated"),index=0;index<t.length;++index){r="<option value='"+t[index].value+"' > "+t[index].text+"</option>";jQuery("#jform_venue").append(r),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated")}}else{jQuery("#jform_venue").prop("disabled",!1);r="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_EVENT_DEFAULT_VENUE_OPTION")+"</option>";for(jQuery("#jform_venue").append(r),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated"),index=0;index<t.length;++index){r="<option value='"+t[index].value+"' > "+t[index].text+"</option>";jQuery("#jform_venue").append(r),jQuery("#jform_venue").trigger("liszt:updated"),jQuery("#jform_venue").trigger("chosen:updated")}}e()}})}))},ConvertTimeformat:function(e,t,o,r){t=parseInt(t),"PM"==r&&t<12&&(t+=12),"AM"==r&&12==t&&(t-=12),t<10&&(t="0"+t),(o=parseInt(o))<10&&(o="0"+o);var a=new Date(e+" "+t+":"+o+":00").toISOString();return(a=a.substring(0,a.length-5)).replace("T"," ")},existingEvents:function(){var e=jQuery("input[name='jform[online_events]']:checked").val();"new"==jQuery("input[name='jform[venuechoice]']:checked").val()&&"1"==e?jQuery("#form_existingEvent").hide():jQuery("#form_existingEvent").show()},selectExistingEvent:function(){var e=document.getElementById("jform_venue").value,t=jQuery('input[type=radio][name="jform[online_events]"]:checked').val();jQuery("#jform_existing_event option").remove();var o=jQuery("#jform_existing_event"),r="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_SELECT_EXISTING_EVENT_OPTION")+"</option>";o.append(r),"0"!=e&&"1"==t&&JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"event.getAllMeetings",venueId:e}}).done((function(e){if(!0===e.success){var t=e.data;null!=t&&Array.isArray(t)&&t.forEach((function(e){r=existing_url==e.id?"<option value='"+e.id+"' selected='selected'>"+e.title+" ("+e.start_time+")</option>":"<option value='"+e.id+"' >"+e.title+" ("+e.start_time+")</option>",o.append(r)}))}})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_EVENT_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){o.trigger("liszt:updated"),o.trigger("chosen:updated")}))},selectExistingEventOnload:function(){if(!existing_url){var e=jQuery('input[type=radio][name="jform[online_events]"]:checked').val();if("0"!=venueId&&"1"==e){jQuery("#jform_existing_event option").remove();var t=jQuery("#jform_existing_event"),o="<option value='' selected='selected'>"+Joomla.JText._("COM_JTICKETING_FORM_SELECT_EXISTING_EVENT_OPTION")+"</option>";t.append(o),JTicketing.Ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing",data:{task:"event.getAllMeetings",venueId:venueId}}).done((function(e){if(!0===e.success){var r=e.data;null!=r&&Array.isArray(r)&&r.forEach((function(e){o=existing_url==e.id?"<option value='"+e.id+"' selected='selected'>"+e.title+" ("+e.start_time+")</option>":"<option value='"+e.id+"' >"+e.title+" ("+e.start_time+")</option>",t.append(o)}))}})).fail((function(e){Joomla.renderMessages({error:[Joomla.JText._("COM_JTICKETING_EVENT_RELATED_AJAX_FAIL_ERROR_MESSAGE")]})})).always((function(){t.trigger("liszt:updated"),t.trigger("chosen:updated")}))}}},existingEventSelection:function(){var e=document.getElementById("jform_venue").value,t=jQuery("#jform_existing_event :selected").val();jQuery("#event_url").val(t),jQuery.ajax({type:"POST",async:!1,data:{venueId:e,venueurl:t},dataType:"json",url:"index.php?option=com_jticketing&format=json&task=event.getScoID",success:function(e){jQuery("#event_sco_id").val(e)},error:function(e){console.log(" ERROR!!")}})},validateDates:function(){jQuery("#jform_startdate").val(),jQuery("#jform_enddate").val(),jQuery("#jform_booking_start_date").val(),jQuery("#jform_booking_end_date").val();return!0}},orders:{initOrdersJs:function(){Joomla.submitbutton=function(e){if("orders.remove"==e){if(1!=confirm(Joomla.JText._("COM_JTICKETING_ORDER_DELETE_CONF")))return!1;Joomla.submitform(e,document.getElementById("adminForm"))}}},selectStatusOrder:function(e,t,o){document.getElementById("order_id").value=e,document.getElementById("payment_status").value=o.value,document.getElementById("processor").value=t;var r=o.selectedIndex,a=o.options[r].value,n="",i="orders.save";if("RF"===a&&(n="REFUND"),"E"===a&&(n="FAILED"),"D"===a&&(n="DECLINE"),"CRV"===a&&(n="CANCEL_REVERSED"),"RV"===a&&(n="REVERSED"),"RF"===a||"E"===a||"D"===a||"CRV"===a||"RV"===a){var u="COM_JTICKETING_ORDER_STATUS_"+n,l=Joomla.JText._("COM_JTICKETING_ORDER_STATUS_MESSAGE1")+Joomla.JText._(u)+Joomla.JText._("COM_JTICKETING_ORDER_STATUS_MESSAGE2");if(!0!==confirm(l)){var s=jQuery(o).data("oldvalue");return jQuery(o).val(s),jQuery(o).trigger("liszt:updated"),jQuery(o).trigger("chosen:updated"),!1}Joomla.submitform(i,document.getElementById("adminForm"))}else Joomla.submitform(i,document.getElementById("adminForm"))}},venue:{initializeGMapSuggest:function(){input=document.getElementById("jform_address");new google.maps.places.Autocomplete(input)},initVenueJs:function(){googleMapApiKey&&google.maps.event.addDomListener(window,"load",jtAdmin.venue.initializeGMapSuggest),jQuery(document).ready((function(){jQuery('input[name="jform[online]').click((function(){jtAdmin.venue.showOnlineOffline(jQuery('input[name="jform[online]"]:checked').val())})),jtAdmin.venue.showOnlineOffline(jQuery('input[name="jform[online]"]:checked').val()),jQuery("#jform_online_provider").change((function(){jtAdmin.venue.getPluginParams()})),jQuery.each(mediaGallery,(function(e,t){tjMediaFile.previewFile(t,1)})),editId&&1==jQuery('input[name="jform[online]"]:checked').val()&&jtAdmin.venue.getPluginParams(),getValue&&jQuery("#jform_online_provider").trigger("change"),jtAdmin.venue.venueCapacityCheck(),jQuery("#jform_seats_capacity").change((function(){jtAdmin.venue.venueCapacityCheck()}))}))},showOnlineOffline:function(e){1==e?(jQuery("#jform_online_provider").closest(".control-group").show(),jQuery("#provider_html").show(),jQuery("#jform_offline_provider").hide()):(jQuery("#jform_online_provider").closest(".control-group").hide(),jQuery("#provider_html").hide(),jQuery("#jform_offline_provider").show())},venueCapacityCheck:function(){0==jQuery("#jform_seats_capacity").val()?jQuery("#jform_capacity_count").addClass("required"):jQuery("#jform_capacity_count").removeClass("required")},venueSubmitButton:function(e){if("venue.apply"==e||"venue.save"==e||"venue.save2new"==e){jQuery('input[name="jform[jform_name]"]:checked').val(),jQuery('input[name="jform[api_username]"]:checked').val(),jQuery('input[name="jform[api_password]"]:checked').val(),jQuery('input[name="jform[host_url]"]:checked').val(),jQuery('input[name="jform[source_sco_id]"]:checked').val();var t=jQuery('input[name="jform[online]"]:checked').val(),o=jQuery("#jform_online_provider").val();if(editId&&"0"==t&&(jQuery("#api_username").val(""),jQuery("#api_password").val(""),jQuery("#host_url").val(""),jQuery("#source_sco_id").val("")),!document.formvalidator.isValid(document.getElementById("venue-form")))return jQuery("html, body").animate({scrollTop:jQuery("#system-message-container").position().top}),!1;if(1==jQuery('input[name="jform[online]"]:checked').val()){if(!o||"0"==o)return r=Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_ONLINE_EVENTS_PROVIDER"),Joomla.renderMessages({warning:[r]}),!1;let e=document.createElement("form");for(fields=jQuery("#provider_html").find("input, textarea, select, fieldset"),i=0,l=fields.length;i<l;i++){let t=fields[i].cloneNode(!0);e.appendChild(t)}if(!document.formvalidator.isValid(e))return!1;jsonObj=[],jQuery("#provider_html input").each((function(){var e=jQuery(this).attr("id"),t=jQuery(this).val();item={},item.id=e,item.output=t;jsonObj.push(item);jsonString=JSON.stringify(item),jQuery("#venue_params").val(jsonString)}))}else if(!jQuery("#jform_address").val()){var r="";return jQuery("#jform_address").val()||(r+="<br />"+Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_FORM_LBL_VENUE_ADDRESS")),Joomla.renderMessages({warning:[r]}),!1}if(!jQuery("#jform_name").val()){r="";return r+="<br />"+Joomla.JText._("COM_JTICKETING_INVALID_FIELD")+Joomla.JText._("COM_JTICKETING_FORM_LBL_VENUE_TITLE"),Joomla.renderMessages({warning:[r]}),!1}jQuery("#system-message-container").html(""),Joomla.submitform(e,document.getElementById("venue-form"))}"venue.cancel"==e&&Joomla.submitform(e,document.getElementById("venue-form"))},getPluginParams:function(){var e=jQuery("#jform_online_provider").val();jQuery.ajax({type:"POST",url:"index.php?option=com_jticketing&task=venue.getelementparams",data:{element:e,venue_id:jQuery("#venue_id").val()},datatype:"HTML",async:"false",success:function(e){jQuery("#provider_html").html(JSON.parse(e).data);var t=jQuery('input[name="jform[online]"]:checked').val();jQuery("#provider_html").css("display","none"),1==t&&(jQuery("#provider_html").css("display","block"),jQuery("#provider_html").trigger("subform-row-add",jQuery("#provider_html")));for(var o=document.getElementsByClassName("input-password-toggle"),r=0;r<o.length;r++)!function(e){o[e].addEventListener("click",(function(){"password"==jQuery(this).prev("input").attr("type")?jQuery(this).prev("input").attr("type","text"):jQuery(this).prev("input").attr("type","password")}))}(r)},error:function(){return jQuery("#provider_html").hide(),!0}}),googleMapApiKey&&google.maps.event.addDomListener(window,"load",(function(){input=document.getElementById("jform_address"),new google.maps.places.Autocomplete(input)}))},getLongitudeLatitude:function(){if(googleMapApiKey){var e=new google.maps.Geocoder;function t(){var t=jQuery("#jform_address").val();e.geocode({address:t},(function(e,t){if(t==google.maps.GeocoderStatus.OK){var o=e[0].geometry.location.lat(),r=e[0].geometry.location.lng();jQuery("#jform_latitude").val(o),jQuery("#jform_longitude").val(r)}}))}jQuery("#jform_address").on("keyup",(function(e){"Enter"===e.key&&t()})),jQuery("#jform_address").on("blur",(function(){t()}))}},getCurrentLocation:function(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,o=e.coords.longitude;jQuery.ajax({type:"POST",url:"index.php?option=com_jticketing&task=venue.getLocation",data:"latitude="+t+"&longitude="+o,dataType:"json",success:function(e){console.log(e);var t=e.location,o=e.longitude,r=e.latitude;e&&(jQuery("#jform_address").val(t),jQuery("#jform_longitude").val(o),jQuery("#jform_latitude").val(r))}})}));else{var e=Joomla.JText._("COM_JTICKETING_ADDRESS_NOT_FOUND"),t=Joomla.JText._("COM_JTICKETING_LONG_LAT_VAL");jQuery("#jform_address").val(e),jQuery("#jform_longitude").val(t),jQuery("#jform_latitude").val(t)}}},coupon:{initCouponJs:function(){jQuery(document).ready((function(){jQuery("#jform_vendor_id").change((function(){jtAdmin.coupon.updateVendorEventsList(this)})),jQuery("#jform_value").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS")),jQuery('#coupon-form input[name="jform[val_type]"]:checked').length&&"1"==jQuery('#coupon-form input[name="jform[val_type]"]:checked').val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100&&(alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""))}));var e=jQuery("#group_discount_tickets_container");"1"!==jQuery("input[name='jform[group_discount]']:checked").val()&&e.addClass("d-none"),jQuery('input[name="jform[group_discount]"]').change((function(){e.toggleClass("d-none","1"!==jQuery(this).val())})),jQuery('#coupon-form input[name="jform[val_type]').change((function(){jQuery('#coupon-form input[name="jform[val_type]"]:checked').length&&"1"==jQuery('#coupon-form input[name="jform[val_type]"]:checked').val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100&&(alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""))})),jQuery("#jform_limit").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS"))})),jQuery("#jform_max_per_user").change((function(){validation.checkForZeroAndAlpha(this,"46",Joomla.JText._("COM_JTICKETING_ENTER_NUMERICS"))}))}))},couponSubmitButton:function(e){if(jQuery('#coupon-form input[name="jform[val_type]"]:checked').length&&"1"==jQuery('#coupon-form input[name="jform[val_type]"]:checked').val()&&jQuery("#jform_value").val()&&parseInt(jQuery("#jform_value").val())>100)return alert(Joomla.JText._("COM_JTICKETING_COUPON_PERCENTAGE_ERROR")),jQuery("#jform_value").val(""),!1;("coupon.cancel"==e||"coupon.cancel"!=e&&document.formvalidator.isValid(document.getElementById("coupon-form")))&&Joomla.submitform(e,document.getElementById("coupon-form"))},updateVendorEventsList:function(e){var t=e.value;jQuery.ajax({url:Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=coupons.getVendorSpecificEvents",type:"GET",data:"vendorId="+t,dataType:"json",success:function(e){if(1!==e.error||null!==e)if(jQuery("#jform_event_ids").find("option").remove(),jQuery("#jform_event_ids").trigger("liszt:updated"),jQuery("#jform_event_ids").trigger("chosen:updated"),jQuery(".sa-coupon.bs5").length)if(0!==Object.keys(e.events).length){var t=techjoomla.jQuery("#jform_event_ids");techjoomla.jQuery.each(e.events,(function(e,o){console.log("ID:",o.id,"Title:",o.title),t.append(techjoomla.jQuery("<option>",{value:o.id,text:o.title}))}))}else alert(Joomla.JText._("COM_JTICKETING_COUPON_NO_EVENT_FOUND"));else if(0!==e.events.length)for(var o=0;o<e.events.length;o++)jQuery("#jform_event_ids").append(new Option(e.events[o].title,e.events[o].id)),jQuery("#jform_event_ids").trigger("liszt:updated"),jQuery("#jform_event_ids").trigger("chosen:updated");else alert(Joomla.JText._("COM_JTICKETING_COUPON_NO_EVENT_FOUND"))}})}}};function showOnlineOffline(e){1==e?(jQuery("#jform_online_provider").closest(".control-group").show(),jQuery("#provider_html").show(),jQuery("#jform_offline_provider").hide()):(jQuery("#jform_online_provider").closest(".control-group").hide(),jQuery("#provider_html").hide(),jQuery("#jform_offline_provider").show())}function validateOnlineOffline(e){1==e?(jQuery("#jform_online_provider").closest(".control-group").show(),jQuery("#provider_html").show(),jQuery("#jform_offline_provider").hide(),jQuery("#jform_address").removeAttr("required"),jQuery("#jform_address").removeClass("required")):(jQuery("#jform_online_provider").closest(".control-group").hide(),jQuery("#provider_html").hide(),jQuery("#jform_offline_provider").show(),jQuery("#api_username").removeAttr("required"),jQuery("#api_username").removeClass("required"),jQuery("#host_url").removeAttr("required"),jQuery("#host_url").removeClass("required"),jQuery("#api_password").removeAttr("required"),jQuery("#api_password").removeClass("required"),jQuery("#source_sco_id").removeAttr("required"),jQuery("#source_sco_id").removeClass("required"))}var tjMediaFile={validateFile:function(e,t,o,r){e instanceof jQuery||(e=jQuery(e));var a=jQuery(e).attr("type");if("file"==a){var n=jQuery(e)[0].files[0];if(mediaSize<n.size/1e6)return alert(Joomla.JText._("COM_TJMEDIA_VALIDATE_MEDIA_SIZE")),!1;tjMediaFile.uploadFile(n,e,a,t,o,r)}else fileLink=jQuery("#jform_gallery_link").val(),tjMediaFile.uploadFile(fileLink,e,"link",t,o,r)},uploadFile:function(e,t,o,r,a,n){var i=new FormData;"file"==o?(i.append("file[]",e),i.append("upload_file",o),i.append("isGallary",r)):"link"==o&&(i.append("upload_type",o),i.append("name",e),i.append("type","youtube")),url=0!=a?"index.php?option=com_jticketing&format=json&task="+n+".uploadMedia":Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task="+n+".uploadMedia",this.ajaxObj=jQuery.ajax({type:"POST",url:url,dataType:"JSON",contentType:!1,processData:!1,data:i,xhr:function(){var e=jQuery.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var o=Math.floor(e.loaded/e.total*100);tjMediaFile.progressBar.updateStatus(t.id,o)}}),!1),e},beforeSend:function(e){tjMediaFile.progressBar.init(t.id,"")},success:function(e){if(jQuery("#system-message-container").empty(),e.success)1===r&&("video.youtube"==e.data[0].type||0===e.data[0].valid?jQuery("#jform_gallery_link").val(""):jQuery(t).val("")),tjMediaFile.previewFile(e.data[0],r),tjMediaFile.progressBar.statusMsg(t.id,"success",e.message);else if("link"==o){var a=[e.message];Joomla.renderMessages({warning:a})}else jQuery(t).val(""),jQuery("#"+t.id).siblings(".progress").remove(),tjMediaFile.progressBar.statusMsg(t.id,"error",e.message),alert(e.message)},error:function(e,o,r){tjMediaFile.progressBar.statusMsg(t.id,"error",r)}})},previewFile:function(e,t){return e.id&&(1==t?tjMediaFile.tjMediaGallery.appendMediaToGallary(e):2==t?(jQuery("#uploaded_media_cover").attr("src",e[eventMainImage]),jQuery("#uploaded_media_cover").closest(".thumbnails").removeClass("hide_jtdiv"),jQuery("#jform_event_cover_old_image").val(jQuery("#jform_event_coverImage").val()),jQuery("#jform_event_coverImage").val(e.id)):(jQuery("#uploaded_media").attr("src",e[eventMainImage]),jQuery("#uploaded_media").closest(".thumbnails").removeClass("hide_jtdiv"),jQuery("#jform_event_old_image").val(jQuery("#jform_event_image").val()),jQuery("#jform_event_image").val(e.id))),!1},progressBar:{init:function(e,t){jQuery("#"+e).siblings(".alert").remove(),jQuery("#"+e).siblings(".progress").remove(),this.progress=jQuery("<div class='progress progress-striped active'><div class='bar'></div><button onclick='return tjexport.abort();' class='btn btn-danger btn-small pull-right'>Abort</button></div>"),this.statusBar=this.progress.find(".bar"),this.abort=jQuery("<div class='abort'><span>Abort</span></div>").appendTo(this.statusbar),jQuery("#"+e).closest(".controls").append(this.progress)},updateStatus:function(e,t){this.statusBar.css("width",t+"%"),this.statusBar.text(t+"%")},abort:function(){if(!confirm(Joomla.JText._("LIB_TECHJOOMLA_CSV_EXPORT_CONFIRM_ABORT")))return!1;this.ajaxObj.abort()},statusMsg:function(e,t,o){setTimeout((function(){jQuery("#"+e).siblings(".progress").remove()}),2e3);var r=jQuery("<div class='alert alert-"+t+"'><strong>"+o+"</strong><a href='#' class='close' data-dismiss='alert' aria-label='close' title='close'>Ã—</a></div>");jQuery("#"+e).closest(".controls").append(r)}},tjMediaGallery:{appendMediaToGallary:function(e){var t=jQuery(".gallary__media li.gallary__media--li:first-child").clone(),o=e.type.split(".");if("video"===o[0]){var r=jQuery(".jt-event-frontend-edit").length?"107":"160";"youtube"===o[1]?mediaTag="<iframe width=' "+r+"' height='113' src="+e.path+"> </iframe>":mediaTag="<video width=' "+r+"' height='113' class='media_video_width' preload='metadata' controls ><source src="+e.path+"></video>"}else"image"===o[0]&&(mediaTag="<img src="+e[galleryImage]+" class='media_image_width'>");t.removeClass("hide"),t.find(".thumbnail").append(mediaTag),t.find(".media_field_value").val(e.id),t.find(".media_field_value").attr("id","media_id_"+e.id),t.appendTo(".gallary__media")},deleteMedia:function(e,t,o,r){var a=jQuery(e);if(url=1==t?"index.php?option=com_jticketing&format=json&task="+r+".deleteMedia":Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&format=json&task="+r+".deleteMedia",!confirm(Joomla.JText._("JGLOBAL_CONFIRM_DELETE")))return!1;var n=a.next().val();jQuery.ajax({type:"POST",url:url,dataType:"JSON",data:{id:n,client_id:o},success:function(e){a.closest(".gallary__media--li").remove()},error:function(e,t,o){tjMediaFile.progressBar.statusMsg(a.id,"error",o)}})}}},attendees={enrollmentStatusBar:{createStatusbar:function(e){this.statusbar=jQuery("<div class='statusbar'></div>"),this.filename=jQuery("<div class='filename'></div>").appendTo(this.statusbar),this.size=jQuery("<div class='filesize'></div>").appendTo(this.statusbar),this.success=jQuery('<div class="msg alert"></div>').appendTo(this.statusbar),this.error=jQuery('<div class="msg alert"></div>').appendTo(this.statusbar),e.closest(".controls").append(this.statusbar),this.setFileNameSize=function(e,t){var o="",r=t/1024;parseInt(r)>1024?o=(r/1024).toFixed(2)+" MB":o=r.toFixed(2)+" KB";this.filename.html(e),this.size.html(o)},this.setMsg=function(e,t){if(this.statusbar.show(),e.errormsg){var o=e.errormsg;this.error.addClass("alert alert-error"),this.error.html(o),this.error.show()}if(e.successmsg){var r=e.successmsg;this.success.addClass("alert alert-success"),this.success.html(r),this.success.show()}if(e.messages){var a=jQuery("<div>").addClass("import-messages");this.success.removeClass("msg alert"),jQuery.each(e.messages,(function(e,t){var o=Object.keys(t)[0],r=jQuery("<div>").addClass("alert alert-"+o).html(t[o]).get(0);a.append(r)})),this.success.html(a),this.success.show()}}}}},jtCommon={enrollment:{validate_import:function(e,t,o,r){if(!jQuery(e).val())return!1;jQuery(e).closest(".controls").children(".statusbar").remove();var a=jQuery(e),n=new attendees.enrollmentStatusBar.createStatusbar(a),i=jQuery(e)[0].files[0],u=jQuery("#notify_user_enroll").prop("checked"),l=i.name;if("csv"!=l.split(".").pop()){var s=new Object;return s.errormsg=nonvalid_extension,n.setMsg(s,"alert-error"),!1}jtCommon.enrollment.progressBar(o,!0);var d=jQuery(".fileupload-preview",jQuery(e).closest(".fileupload-new"));jQuery(d).show(),jQuery(d).text(l),jtCommon.enrollment.startImporting(i,n,e,t,o,r,u)},progressBar:function(e,t){return!!e&&(1==t?jQuery("<div class='control-group'><div class='progress-line'></div></div>").prependTo(e):jQuery(e+" .progress-line").remove(),jQuery(e+" :input").prop("disabled",t),jQuery(e+" :button").prop("disabled",t),!0)},startImporting:function(e,t,o,r,a,n,i){new Object;if(void 0===e)return t.setMsg(file_not_selected_error,"alert-error"),!1;if(void 0!==window.FormData){if(1==r)jtCommon.enrollment.sendImportFileToServer(e,t,o,1,a,i);return!1}alert("You need to upgrade your browser as it does not support FormData")},sendImportFileToServer:function(e,t,o,r,a,n){var i=new FormData;i.append("FileInput",e),i.append("notifyUser",n);var u=!0;jQuery.ajax({url:"index.php?option=com_jticketing&task=attendees.csvImport&tmpl=component",type:"POST",data:i,mimeType:"multipart/form-data",contentType:!1,dataType:"json",cache:!1,processData:!1,success:function(e){var o=e.OUTPUT;1==o.return&&(t.setMsg(o),jQuery("#user-csv-upload").val(""),jtCommon.enrollment.progressBar(a,!1))},error:function(e,o="",r=""){var n=new Object;n.errormsg=e.responseText,t.setMsg(n,"alert-error"),jtCommon.enrollment.progressBar(a,!1),u=!1}});return u},updateEnrollment:function(e,t,o,r){var a="",n=jQuery("#notify_user_"+e).is(":checked"),i=jQuery("#eid_"+e).val();if("update"===o?a=jQuery("#assign_"+e+" option:selected").val():"moveAttendee"===o&&(a="M"),"M"===a){jQuery("#move_attendee").modal("show");var u=jQuery("#owner_"+e).val();jQuery("#userId").val(u),jQuery("#eventId").val(i),jQuery("#attendeeId").val(t),jQuery("#selected_event option[value='"+i+"']").remove(),jQuery("#selected_event").trigger("liszt:updated"),jQuery("#selected_event").trigger("chosen:updated")}else url=1===r?"index.php?option=com_jticketing&task=attendees."+o:jtRootURL+"index.php?option=com_jticketing&task=attendees."+o,jQuery("#ajax_loader").html("<img src="+Joomla.getOptions("system.paths").base+"/media/com_jticketing/images/ajax-loader.gif>"),jQuery("#ajax_loader").show(),jQuery.ajax({url:url,type:"POST",dataType:"json",data:{id:t,value:a,notify:n,eid:i},beforeSend:function(){jQuery("#ajax_loader").html("<img src="+Joomla.getOptions("system.paths").base+"/media/com_jticketing/images/ajax-loader.gif>")},complete:function(){jQuery("#ajax_loader").hide()},success:function(e){Joomla.renderMessages(e.messages),location.reload()}})},saveEnrollment:function(e){return 0==document.adminForm.boxchecked.value?(alert(Joomla.JText._("COM_JTICKETING_SELECT_USER_TO_ENROLL")),!1):jQuery("#selected_events").val()?void Joomla.submitform("enrollment."+e):(alert(Joomla.JText._("COM_JTICKETING_SELECT_EVENT_TO_ENROLL")),!1)},deleteEnrollment:function(e){confirm(Joomla.JText._("COM_JTICKETING_ARE_YOU_SURE_YOU_TO_DELETE_THE_ATTENDEE"))&&(url=Joomla.getOptions("system.paths").base+"/index.php?option=com_jticketing&task=attendees.remove",jQuery.ajax({url:url,type:"POST",dataType:"json",data:{id:e},beforeSend:function(){jQuery("#ajax_loader").html("<img src="+Joomla.getOptions("system.paths").base+"/media/com_jticketing/images/ajax-loader.gif>")},complete:function(){jQuery("#ajax_loader").hide()},success:function(e){alert(e.message),location.reload()},error:function(e){console.log(e.message)}}))}},waitinglist:{changeStatus:function(e,t){var o=jQuery("#assign_"+e+" option:selected").val(),r=jQuery("#event_id_"+e).val(),a=jQuery("#user_id_"+e).val();"C"==o?(document.getElementById("wid").value=t,Joomla.submitform("waitinglist.enroll")):"CA"==o&&(1===isAdmin?url="index.php?option=com_jticketing&format=json&task=waitlistform.changeStatus":url=jtRootURL+"index.php?option=com_jticketing&format=json&task=waitlistform.changeStatus",jQuery.ajax({url:url,type:"POST",dataType:"json",data:{id:t,status:o,eventid:r,userid:a},beforeSend:function(){jQuery("#ajax_loader").html("<img src="+Joomla.getOptions("system.paths").base+"/media/com_jticketing/images/ajax-loader.gif>")},complete:function(){jQuery("#ajax_loader").hide()},success:function(e){if(e.success){var t=[e.message];Joomla.renderMessages({success:t})}else{var o=[e.message];Joomla.renderMessages({error:o})}}}))}},attendees:{attendeesSubmitButton:function(e,t){if(""===e)return!1;var o=document.getElementById("selected_emailids"),r=document.getElementById("jt-message-subject"),a=tinyMCE.activeEditor.getContent();if("cancelEmail"!=e.split(".")[1]){var n={error:[]};if(""===r.value)return jQuery("#system-message-container").removeClass("span10"),jQuery("#system-message-container").addClass("span12"),n.error.push(Joomla.JText._("COM_JTICKETING_EMAIL_SUBJECT_ERROR_MSG")),Joomla.renderMessages(n),!1;if(""===a)return jQuery("#system-message-container").removeClass("span10"),jQuery("#system-message-container").addClass("span12"),n.error.push(Joomla.JText._("COM_JTICKETING_EMAIL_BODY_ERROR_MSG")),Joomla.renderMessages(n),!1}else Joomla.submitform(e);url=jtRootURL+"index.php?option=com_jticketing&format=json&task="+e,jQuery.ajax({url:url,type:"POST",dataType:"json",data:{messageSubject:r.value,messageBody:a,isAdmin:t,emailIds:o.value},beforeSend:function(){document.getElementById("ajax_loader").style.backgroundImage="url("+jtRootURL+"/media/com_jticketing/images/loadinfo.gif)",jQuery("#ajax_loader").show()},complete:function(){jQuery("#ajax_loader").hide()},success:function(e){e.success?(Joomla.renderMessages({success:[e.message]}),window.onbeforeunload=null,window.location.href=e.data):Joomla.renderMessages({error:[e.message]})}})}}},jtCounter={jtCountDown:function(e,t,o,r,a){var n=t;a&&(n=o),jQuery("#"+e).countdown(n).on("update.countdown",(function(e){var t=msg="";e.offset.totalDays>0?(msg=Joomla.JText._("JT_EVENT_COUNTER_STARTS_IN_DAYS"),a&&(msg=Joomla.JText._("JT_EVENT_COUNTER_ENDS_IN_DAYS")),t=msg.replace("%s","%-D")):0==e.offset.totalDays&&(msg=Joomla.JText._("JT_EVENT_COUNTER_STARTS_IN_TIME"),a&&(msg=Joomla.JText._("JT_EVENT_COUNTER_ENDS_IN_TIME")),t=msg.replace("%s","%H:%M:%S")),jQuery(this).html(e.strftime(t))})).on("finish.countdown",(function(a){o>r&&jtCounter.jtCountDown(e,t,o,r,"1"),o<r&&jQuery(this).html(Joomla.JText._("JT_EVENT_COUNTER_EXPIRE"))})).on("stoped.countdown",(function(e){jQuery(this).html(Joomla.JText._("JT_EVENT_COUNTER_EXPIRE"))}))}},validation={positiveNumber:function(){jQuery(window).on("load",(function(){document.formvalidator.setHandler("positive-number",(function(e,t){e=punycode.toASCII(e);return/^[+]?([0-9]+(?:[\.][0-9]*)?|\.[0-9]+)$/.test(e)}))}))},formatDateTime:function(e){var t=e.getFullYear(),o=""+(e.getMonth()+1),r=""+e.getDate(),a=""+e.getHours(),n=""+e.getMinutes(),i=""+e.getSeconds();return o.length<2&&(o="0"+o),r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),i.length<2&&(i="0"+i),t+"-"+o+"-"+r+" "+a+":"+n+":"+i},checkForZeroAndAlpha:function(e,t,o){e.value<=0&&(alert(Joomla.JText._("COM_JTICKETING_MIN_AMT_SHOULD_GREATER_MSG")),e.value="")}};